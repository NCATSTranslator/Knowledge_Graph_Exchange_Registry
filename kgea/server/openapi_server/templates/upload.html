{% extends "layout.html" %}
{% block scripts %}
    <script>
        async function UploadFile(source) {
            console.log("UploadFile(session: {{session}}, upload_mode: '" + source.id + "')");

            let formData = new FormData();
            formData.append("session", "{{session}}");
            formData.append("upload_mode", source.id);

            if (source.id == 'content_from_url') {
                // Transfer file from REST URL endpoint
                let content_url = document.getElementById('content_url').value;
                console.log("Content URL: '" + content_url + "')");
                formData.append("content_url", content_url);
            } else if (source.id == 'metadata') {
                let uploaded_file = document.getElementById('metadata_file').files[0];
                console.log("KGX metadata file being uploaded: '" + uploaded_file.filename + "')");
                formData.append("uploaded_file", uploaded_file);
            } else if (source.id == 'content_from_local_file') {
                let uploaded_file = document.getElementById('content_file').files[0];
                console.log("KGX data file being uploaded: '" + uploaded_file.filename + "')");
                formData.append("uploaded_file", uploaded_file);
            } else  {
                return false;
            }

            try {
               let r = await fetch('/upload', {method: "POST", body: formData});
               console.log('HTTP response code:',r.status);
            } catch(e) {
               console.log('File upload error:', e);
            }

            // suppress propagation of html form 'submit'
            return false;
        }
    </script>
{% endblock %}
{% block menu %}
{% include "logout.html" %}
{% endblock %}
{% block content %}
    <h1>Upload KGE (Meta)Data Files</h1>

    <h3>Uploading of KGE File Set for "{{kg_name}}", submitted by {{submitter}}</h3>

    <br>
    <h4>Select Metadata File for Upload:</h4>
    <p>Must be valid KGX metadata generated from your dataset. Read more <a href="https://github.com/biolink/kgx">here</a>.

    <form id="metadata" onsubmit="UploadFile(this)">
        <label for="metadata_file"><b>Select Metadata File: </b></label>
        <input id="metadata_file" class="textbox" type="file"/>
        <input type="submit"  value="Upload"/>
    </form>

    <br>
    <h4>Upload local KGX file from your computer:</h4>
    <p>Single file selection (for now) for upload (this may be changed in further releases).
    <form id="content_from_local_file" onsubmit="UploadFile(this)">
        <label for="content_file"><b>Select Data File:</b></label>
        <input id="content_file"  class="textbox" type="file"/>
        <input type="submit"  value="Upload"/>
    </form>

    <br>
    <h4>Transfer file from URL:</h4>
    <p>(Alternative) Specify a URL pointing to a KGX file to transfer to the archive:
    <form  id="content_from_url" onsubmit="UploadFile(this)">
        <label for="content_url"><b>URL to File:</b></label>
        <input id="content_url" type="text"/>
        <input type="submit"  value="Initiate Transfer"/>
    </form>
{% endblock %}
