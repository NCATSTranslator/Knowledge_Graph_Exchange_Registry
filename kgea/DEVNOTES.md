# Developers' Notes

This file complement both the ["Getting Started"](README.md) document which outlines KGE Archive deployment procedures and the [KGE Archive Roadmap](KGE_ARCHIVE_ROADMAP.md) document which outlines the details about the KGE Archive implementation components. Here, we document a few KGE Archive development issues and recommended (required?) responses.

# OpenAPI Server Code Generation

The OpenAPI 3 code generation process described under the section about the [KGE Archive Server](#2-kge-archive-server), and involves running the [generate-kge-server.sh](../scripts/generate-kge-server.sh) script from the root of the KGE Archive project, i.e.

```shell
cd /path/to/your/local/Knowledge_Graph_Exchange
./scripts/generate-kge-server.sh
```

The code generator creates a basic README file under the [KGEA Server subdirectory](./server/README.md) which provides basic instructions about how to run the resulting server code, either from a OS terminal or within a Docker container.

Rerunning the server code generation basically appears to rewrite most of the contents of the [KGEA Server subdirectory](./server) with a few notable exceptions such as:

- extra files added to the subdirectory by the developer, which are files not generated by the code generator, including files from previous runs which were not required to be generated by a new run (i.e. when specific parts - tags, operation ids, components - of the API were renamed or deleted)
  
- existing test files (under the [server/openapi_server test subdirectory](./server/openapi_server/test)) which were modified by a developer after the original code generation.

- not sure what else (need to review...)

However, the code generation process pretty well overwrites every other file it knows about by name, with fresh code.

This basically means that it is advisable to separate custom handlers to every api controller method in a separate file, then insert delegation calls in the api controller method, perhaps mainly in the `return` statement of the generated method. Namely:

```python
def access(kg_name):  # noqa: E501
    """Get KGE File Sets

     # noqa: E501

    :param kg_name: Name label of KGE File Set whose files are being accessed
    :type kg_name: str

    :rtype: Dict[str, Attribute]
    """
    return 'do some magic!'
```

becomes something like:

```python
from kge_handlers import kge_access

def access(kg_name):  # noqa: E501
    """Get KGE File Sets

     # noqa: E501

    :param kg_name: Name label of KGE File Set whose files are being accessed
    :type kg_name: str

    :rtype: Dict[str, Attribute]
    """
    return kge_access(kg_name)
```

where `kge_access` is a handler method defined in the project developer defined Python module `kge_handlers`, assumed to be sitting alongside the generated api code in `provider_controller.py` (under the `openapi_server/controllers` package in the code generated `server` subdirectory of the KGE Archive project).

This code delegation needs to be repaired every time the code generator is run on the `kgea_api.yaml` specification.
